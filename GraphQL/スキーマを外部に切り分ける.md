### ã‚¹ã‚­ãƒ¼ãƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¤–éƒ¨åŒ–

- [ApolloServer ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«](https://www.apollographql.com/docs/apollo-server/getting-started) ã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ã€ã‚¹ã‚­ãƒ¼ãƒã®å®šç¾©ã¨ Resolver ã®å®Ÿè£…ãŒ1ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§è¡Œã‚ã‚Œã¦ã„ã‚‹

    ```ts
    //server.ts
    import { ApolloServer } from '@apollo/server';
    import { startStandaloneServer } from '@apollo/server/standalone';

    //ã‚¹ã‚­ãƒ¼ãƒå®šç¾©
    const typeDefs = `#graphql
        type Book {
            title: String
            author: String
        }

        type Query {
            books: [Book]
        }
    `;

    //Resolverã®å®Ÿè£…
    const resolvers = {
        Query: {
            books: () => books,
        },
    };

    //ã‚µãƒ¼ãƒãƒ¼èµ·å‹•
    const server = new ApolloServer({
    typeDefs,
    resolvers,
    });

    const { url } = await startStandaloneServer(server, {
        isten: { port: 4000 },
    });

    console.log(`ğŸš€  Server ready at: ${url}`);
    ```

    â†’ã‚¹ã‚­ãƒ¼ãƒã¨å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸€ç·’ã«ã—ã¦ã—ã¾ã†ã“ã¨ã®å¼Šå®³ãŒã„ã‚ã„ã‚ã‚ã‚‹

    - ã‚¹ã‚­ãƒ¼ãƒã®ä¿®æ­£ãªã®ã«ã€resolver ã®å®Ÿè£…ã‚„ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ã¾ã§æ›¸ã„ã¦ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã«è§¦ã‚‹ã®ã§ã€æœ¬æ¥ã®ç›®çš„ã§ã¯ãªã„ãƒ†ã‚¹ãƒˆã¾ã§ç¯„å›²ãŒåºƒããªã£ã¦ã—ã¾ã†

    - â˜…[codegen](./codegen.md) ã«ã‚ˆã‚‹å‹æƒ…å ±ãƒ•ã‚¡ã‚¤ãƒ«ã®ç”ŸæˆãŒé›£ã—ããªã‚‹

        - top-level await ãŒã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦ã® codegen ã¯ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã®ã§ã€ApolloServerã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã§ç´¹ä»‹ã•ã‚Œã¦ã„ã‚‹ server.ts ã«å¯¾ã—ã¦ã¯ codegen ã«ã‚ˆã‚‹å‹æƒ…å ±ãƒ•ã‚¡ã‚¤ãƒ«ã®ç”Ÿæˆã¯ã§ããªã„

---

### ã‚¹ã‚­ãƒ¼ãƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¤–éƒ¨åŒ–ã™ã‚‹

```
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ
projet root
    |-src
        |-server
    |-schema
        |-schema.gql
```

- `.gql` ã‹ `.graphql` æ‹¡å¼µå­ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ

    ```graphql
    #schema/schema.gql
    type Book {
        title: String
        author: String
    }

    type Query {
        books: [Book]
    }
    ```

<br>

- ã‚¹ã‚­ãƒ¼ãƒã‚’tsãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰èª­ã¿è¾¼ã‚€

    ```ts
    //src/server.ts
    import { ApolloServer } from '@apollo/server';
    import { startStandaloneServer } from '@apollo/server/standalone';
    import fs from "fs";
    import path from "path";

    //ã‚¹ã‚­ãƒ¼ãƒã‚’ãƒ™ã‚¿æ›¸ãã§ã¯ãªãã€fsã§èª­ã¿è¾¼ã‚€
    const typeDef = fs.readFileSync(
        path.resolve(import.meta.dirname, "../schema/shema.gql"),
        "utf-8"
    );

    //ä»¥ä¸‹çœç•¥
    ```

<br>
<br>

å‚è€ƒã‚µã‚¤ãƒˆ

[Generating Types from a GraphQL Schema](https://www.apollographql.com/docs/apollo-server/workflow/generate-types)

---

### ã‚¹ã‚­ãƒ¼ãƒãƒ•ã‚¡ã‚¤ãƒ«ã®åˆ†å‰²

- #### [ä¸Šã§ç´¹ä»‹ã—ãŸæ–¹æ³•](#ã‚¹ã‚­ãƒ¼ãƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¤–éƒ¨åŒ–ã™ã‚‹)ã®å•é¡Œç‚¹

    1. ã‚¹ã‚­ãƒ¼ãƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¤‡æ•°ã«åˆ†å‰²ã§ããªã„

        - ãƒ‡ãƒ¼ã‚¿ (Object) ã‚„æ“ä½œ (Query, Mutation, Subscription) ãŒå¢—ãˆã‚‹ã¨ãƒ•ã‚¡ã‚¤ãƒ«ãŒè‚¥å¤§åŒ–ã—ã¦ã„ã

        - ãƒãƒ¼ãƒ ã§é–‹ç™ºã™ã‚‹æ™‚ã€è¡çªã™ã‚‹å¯èƒ½æ€§ãŒé«˜ããªã‚‹

    <br>

    2. fs ã¯ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€ã ã‘ã§ã€SDL ã‚’åˆ†æã—ãªã„

<br>


- `@graphql-tools` ã§æä¾›ã•ã‚Œã¦ã„ã‚‹æ©Ÿèƒ½ã‚’ä½¿ã†ã¨ç°¡å˜ã«ã‚¹ã‚­ãƒ¼ãƒã®åˆ†å‰²&åˆ©ç”¨æ™‚ã®ãƒãƒ¼ã‚¸ã‚’å®Ÿç¾ã§ãã‚‹

    - `@graphql-tools` ã¯ã‚¹ã‚³ãƒ¼ãƒ—ãªã®ã§ã€`npm install @graphql-tools` ã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¯¾è±¡ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’æŒ‡å®šã—ã¦ã„ãªã„ã®ã§ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹

    - `npm install @graphql-tools/schema` ã®ã‚ˆã†ã« `/<@ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å>` ã¾ã§ã¤ã‘ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹


<br>

- [1ãƒ•ã‚¡ã‚¤ãƒ«ã ã‘ã®ã‚¹ã‚­ãƒ¼ãƒãƒ•ã‚¡ã‚¤ãƒ«ã®å¤–éƒ¨åŒ–ã®å•é¡Œ](#ä¸Šã§ç´¹ä»‹ã—ãŸæ–¹æ³•ã®å•é¡Œç‚¹)ã‚’è§£æ±ºã™ã‚‹ãŸã‚ã«ã€ .gql ã‚’è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã«åˆ†ã‘ã¦ç®¡ç†ã—ã€åˆ©ç”¨ã™ã‚‹æ™‚ã«ã¯1ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ãƒãƒ¼ã‚¸ã™ã‚‹ã®ãŒä¸€èˆ¬çš„ãªã‚¹ã‚­ãƒ¼ãƒãƒ•ã‚¡ã‚¤ãƒ«ã®é‹ç”¨&åˆ©ç”¨æ–¹æ³•

    <img src="./img/Schema-Split_1.svg" />

<br>

#### ã‚µãƒ³ãƒ—ãƒ«

<img src="./img/Schema-Split_2.svg" />

<br>

- å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

    - `@graphql-tools/load-files`

        - .gql/.graphql ãƒ•ã‚¡ã‚¤ãƒ«ãƒ­ãƒ¼ãƒ€ãƒ¼

    <br>

    - `@graphql-tools/merge`

        - è¤‡æ•°ã®ã‚¹ã‚­ãƒ¼ãƒã‚’ãƒãƒ¼ã‚¸ã™ã‚‹æ©Ÿèƒ½ã‚’æä¾›ã™ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸


    ```bash
    npm install @graphql-tools/load-files @graphql-tools/merge
    ```

<br>

- todo.gql

    ```graphql
    type Todo {
        id: ID!
        title: String
        completed: Boolean
    }
    ```

<br>

- todo.query.gql

    ```graphql
    type Query {
        getAllTodos: [Todo!]
    }
    ```

<br>

- todo.mutation.gql

    ```graphql
    type Mutation {
        createTodo(title: String): Todo!
        deleteAll: Boolean
    }
    ```

<br>

- server.ts

    - â˜…ã‚¹ã‚­ãƒ¼ãƒã‚’èª­ã¿è¾¼ã‚€ `loadFilesSync` ã«ã¯ [Glob ãƒ‘ã‚¿ãƒ¼ãƒ³](../Glob_Pattern.md)ã‚’ä½¿ã£ãŸæ–‡å­—åˆ—ã‚’æ¸¡ã™

    ```ts
    import { ApolloServer } from '@apollo/server'
    import { startStandaloneServer } from '@apollo/server/standalone'
    //â˜…â†“.gql/.graphql ãƒ­ãƒ¼ãƒ€ãƒ¼
    import { loadFilesSync } from "@graphql-tools/load-files"
    //â˜…â†“ã‚¹ã‚­ãƒ¼ãƒã‚’ãƒãƒ¼ã‚¸ã™ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
    import { mergeTypeDefs } from "@graphql-tools/merge"
    import path from "path";

    //ã‚°ãƒ­ãƒ–ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æŒ‡å®šã—ã¦ã‚‚ã„ã„
    const schema = loadFilesSync(
        `${path.join(import.meta.dirname, "schema")}/**/*.gql`
    )

    //loadFilesSyncã§èª­ã¿è¾¼ã‚“ã ã‚¹ã‚­ãƒ¼ãƒã®ãƒãƒ¼ã‚¸
    const typeDefs = mergeTypeDefs(schema)

    //resolverã®å®Ÿè£…ã¯çœç•¥

    const server = new ApolloServer({
        typeDefs, //ãƒãƒ¼ã‚¸ã—ãŸã‚¹ã‚­ãƒ¼ãƒã‚’æ¸¡ã™
        resolvers
    })

    const { url } = await startStandaloneServer(server, {
        listen: { port: 4000 },
    })
    ```

<br>
<br>

å‚è€ƒã‚µã‚¤ãƒˆ

[Schema Merging](https://the-guild.dev/graphql/tools/docs/schema-merging)

[@graphql-tools/load-files](https://the-guild.dev/graphql/tools/docs/api/modules/load_files_src)

[GraphQLã‚¹ã‚­ãƒ¼ãƒã‚’å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«åŒ–ã™ã‚‹ï¼](https://zenn.dev/osawa_koki/books/f3a06800725213/viewer/03_graphql-schema-outside)

[GraphQLã‚¹ã‚­ãƒ¼ãƒã‚’å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦èª­ã¿è¾¼ã‚€æ–¹æ³•](https://zenn.dev/sc30gsw/articles/qiita-20230701-178606ab97dd7d05219a)

[GraphQLã‚¹ã‚­ãƒ¼ãƒã‚’å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«åŒ–ã™ã‚‹](https://zenn.dev/eringiv3/books/a85174531fd56a/viewer/a8fab6)