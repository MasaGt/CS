### Cipher Suite (暗号スイートとは)

SSL/TLS は暗号化、ハッシュ化などの複数の技術の組み合わせ (Ciper Suite) で成り立っている

= SSL / TLS で利用する以下のアルゴリズムの組み合わせ

- Kx: 通信内容を暗号化するための共通鍵の鍵交換のアルゴリズム **(鍵交換)**

- Au: デジタル署名のアルゴリズム **(認証)**

- Enc: 通信内容を暗号化する共通鍵自体のアルゴリズム **(暗号化)**

- Mac: メッセージ認証に利用される **(ハッシュ化)**


---

### 暗号スイートの記法

TLS 1.2 までの表記方法

```
TLS_鍵交換_署名_WITH_暗号化_鍵長_暗号モード_ハッシュ化
```

例: TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384

上記の暗号スイートは以下のアルゴリズムの組み合わせで行う TLS 通信を意味する

- (Kx) 鍵交換 = ECDHE
- (Au) 署名: RSA
- (Enc) 暗号化: AES256
- (Mac) ハッシュ化: SHA384

<br>
<br>

$\color{red} TLS 1.3 から Cipher Suite の表記方法が変わった$

TLS 1.2までは **「鍵交換」、「署名」、「暗号化」「ハッシュ化」** の4種類を指定していたが、TLS 1.3では、 **「暗号化」と「ハッシュ化」** だけを指定するようになった

<br>

*鍵交換と署名の指定が消えたからといって、**TLS 1.3 から鍵交換と署名を使わなくなったということではない**

- 鍵交換の指定: TLS 1.3 ハンドシェイクの [ClientHello メッセージ](./SSL&TLS.md#ssltls-ハンドシェイクの流れ-tls13) の key_share という拡張領域にてクライアントが鍵交換アルゴリズムの指定 

    - クライアント側が利用できるアルゴリズムを複数指定

    - さらに ClientHello メッセージ の key_share という拡張領域に DH / ECDHE の共有値、クライアント側の公開鍵を設定する

    - サーバー側は、サーバー側で利用できる、かつ優先順位の高い鍵交換アルゴリズムを選択する

<br>

- 署名の指定: TLS 1.3 ハンドシェイクの ClientHelloメッセージ の signature_algorithms という拡張領域にてクライアントが署名方法の指定をする
    - *1つだけ指定するのではなく、優先順位をつけてクライアントで利用できる署名アルゴリズムを複数指定

    - その中でサーバー側が利用できるものかつ、サーバー側で優先順位の高い署名アルゴリズムを利用する

<br>
<br>

TLS 1.3 からの暗号スイートの表記
```
TLS_暗号化_ハッシュ化
```

<br>

例: TLS_AES_256_GCM_SHA384
- (Enc) 暗号化: AES256
- (Mac) ハッシュ化: SHA384

<br>
<br>

その他のポイント
- TLS 1.3 から TLS 1.2 ではサポートしていたセキュリティー強度が低い暗号化アルゴリズム、鍵交換アルゴリズム、署名アルゴリズムの使用を廃止したため、TLS 1.3 で利用できる暗号スイートはかなり少なくなった

    - TLS 1.2 での暗号スイートは多く、ちゃんと安全な組み合わせを選ばないと攻撃の余地を残してしまう危険性があった

<br>

参考サイト

- TLS1.3 のClientHelloから見る鍵交換と署名の指定 -> [example.comのTLS1.3ハンドシェイクを見てみる](https://dorapon2000.hatenablog.com/entry/2021/04/07/051225)

- 暗号スイートの見方 -> [【図解】TLSの暗号化スイートの見方とセキュリティ設定/脆弱性の確認方法](https://milestone-of-se.nesuke.com/nw-basic/tls/cipher-suites-list-vuls/)

- TLS1.3からの暗号スイートについて -> [100種類以上あった「暗号スイート」をたった5種類に、TLS 1.3が互換性を捨てたワケ](https://xtech.nikkei.com/atcl/nxt/column/18/02306/121900003/)

- TLS 1.3 でサポートしているアルゴリズム -> [TLS1.3で使える・使えない暗号アルゴリズム](https://qiita.com/s_machida/items/0f6ef0466503c0f00839)

- 暗号スイートの各アルゴリズムについての説明 -> [TLS1.2と1.3での鍵交換/認証/暗号化に関する用語をまとめる](https://dorapon2000.hatenablog.com/entry/2021/04/05/010928)

- 近年、暗号化とハッシュ化のアルゴリズムがひとまとめになっているらしい -> [SSL/TLSの基本](https://qiita.com/angel_p_57/items/446130934b425d90f89d#各要素の位置づけ)

---

### 追記

- TLS 1.3 では、ClientHello でクライアントが提示した鍵交換のアルゴリズムをサーバーがサポートしていなかった場合、サーバー側から利用可能なアルゴリズムを提示し、再度 ClientHello を送り直してもらうらしい

    - [今更ながら、TLS1.3で大幅変更されたハンドシェイクシーケンスを整理する](https://qiita.com/developer-kikikaikai/items/055a344c847379b471f7#clienthelloのkey_shareが不正だった場合--new)

<br>

- 以下のノートが各要点についてかなり簡潔にまとまっていたのでメモとして残しておく
    - [TLS 1.3 学習ノート](https://zenn.dev/mryhryki/articles/2022-09-08-tls-note)